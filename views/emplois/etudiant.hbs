<div class="page-header">
    <h1>Mon emploi du temps</h1>
    <div style="display: flex; gap: 10px;">
        <span class="badge badge-primary">Ann√©e universitaire 2025 - 2026</span>
    </div>
</div>

{{#if missingProfile}}
    <div class="info-card">
        <h3>Profil {{#if isTeacher}}enseignant{{else if isDirecteur}}directeur{{else}}√©tudiant{{/if}} incomplet</h3>
        <p>{{#if isDirecteur}}Aucun d√©partement n'est associ√© √† votre compte. Merci de contacter l'administration.{{else}}Nous n'avons pas trouv√© de fiche {{#if isTeacher}}enseignant{{else}}√©tudiant{{/if}} associ√©e √† votre compte. Merci de contacter l'administration.{{/if}}</p>
    </div>
{{else if missingGroup}}
    <div class="info-card">
        <h3>Groupe non d√©fini</h3>
        <p>Votre fiche √©tudiante ne contient pas encore d'affectation √† un groupe. Veuillez contacter le service scolarit√©.</p>
    </div>
{{else}}
    <div class="info-card" style="display: flex; flex-wrap: wrap; gap: 20px; align-items: center;">
        <div>
            {{#if isDirecteur}}
                <h3>Emploi du temps - {{departementNom}}</h3>
                <p style="margin-top: 5px; color: var(--text-secondary);">
                    Vue globale du d√©partement
                </p>
            {{else if isTeacher}}
                <h3>{{teacher.prenom}} {{teacher.nom}}</h3>
                <p style="margin-top: 5px; color: var(--text-secondary);">
                    D√©partement : <strong>{{teacher.departement_nom}}</strong>
                </p>
            {{else}}
                <h3>{{student.prenom}} {{student.nom}}</h3>
                <p style="margin-top: 5px; color: var(--text-secondary);">
                    Groupe : <strong>{{groupe.nom}}</strong>
                    {{#if student.specialite_nom}}
                        ‚Ä¢ Sp√©cialit√© : <strong>{{student.specialite_nom}}</strong>
                    {{/if}}
                </p>
            {{/if}}
        </div>
        <div style="margin-left: auto; display: flex; gap: 10px;">
            <span class="badge badge-success">Semestre courant</span>
            {{#if hasCours}}
                <span class="badge badge-info">{{activeDayCount}} jour{{#if (eq activeDayCount 1)}}{{else}}s{{/if}} planifi√©{{#if (eq activeDayCount 1)}}{{else}}s{{/if}}</span>
            {{/if}}
        </div>
    </div>

    {{#unless hasCours}}
        <div class="info-card" style="border-left-color: var(--warning-color);">
            <h3>Aucun cours planifi√©</h3>
            <p>Votre emploi du temps n'a pas encore √©t√© publi√©. Revenez plus tard ou contactez votre responsable de formation.</p>
        </div>
    {{/unless}}

    {{#if hasCours}}
        <!-- L√©gende des couleurs -->
        <div class="info-card" style="margin-bottom: 15px;">
            <h4 style="margin-bottom: 10px; color: var(--text-primary);">üé® L√©gende des types de cours</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 15px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 4px; border: 2px solid #a78bfa;"></span>
                    <span>Cours Magistral (CM)</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 4px; border: 2px solid #34d399;"></span>
                    <span>Travaux Dirig√©s (TD)</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 4px; border: 2px solid #fbbf24;"></span>
                    <span>Travaux Pratiques (TP)</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: linear-gradient(135deg, #ec4899, #db2777); border-radius: 4px; border: 2px solid #f472b6;"></span>
                    <span>Atelier</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="display: inline-block; width: 20px; height: 20px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 4px; border: 2px solid #f87171;"></span>
                    <span>Examen</span>
                </div>
            </div>
        </div>
        
        <div class="calendar-wrapper">
            <div class="calendar-time-column">
                {{#each timeScale}}
                    <div class="calendar-time-slot">{{this}}</div>
                {{/each}}
            </div>
            <div class="calendar-days">
                {{#each schedule}}
                    <div class="calendar-day">
                        <div class="calendar-day-header">{{this.label}}</div>
                        <div class="calendar-day-body" style="height: {{../calendarHeight}}px;">
                            {{#each this.sessions}}
                                <div class="calendar-event {{#if ../../isDirecteur}}calendar-event-directeur{{/if}}" data-type="{{this.type_cours}}" style="top: {{this.position.top}}px; height: {{this.position.height}}px;">
                                    <span class="calendar-event-time">‚è∞ {{this.heure_debut_affiche}} - {{this.heure_fin_affiche}}</span>
                                    <strong class="calendar-event-title">{{this.titre}}</strong>
                                    <span class="calendar-event-meta">üìö {{this.type_label}}</span>
                                    {{#if ../../isDirecteur}}
                                        <span class="calendar-event-detail">üë®‚Äçüè´ {{this.enseignant_affichage}}</span>
                                        <span class="calendar-event-detail">üë• {{this.groupe_affichage}}</span>
                                    {{else if ../../isTeacher}}
                                        <span class="calendar-event-detail">üë• {{this.groupe_affichage}}</span>
                                    {{else}}
                                        <span class="calendar-event-detail">üë®‚Äçüè´ {{this.enseignant_affichage}}</span>
                                    {{/if}}
                                    <span class="calendar-event-detail">üè´ {{this.salle_affichage}}</span>
                                    {{#if ../../isDirecteur}}
                                    <div class="calendar-event-actions">
                                        <a href="/cours/edit/{{this.id}}" class="btn-action btn-edit" title="Modifier">‚úèÔ∏è</a>
                                        <form action="/cours/delete/{{this.id}}" method="POST" style="display:inline;" onsubmit="return confirm('Supprimer ce cours ?');">
                                            <button type="submit" class="btn-action btn-delete" title="Supprimer">üóëÔ∏è</button>
                                        </form>
                                    </div>
                                    {{/if}}
                                </div>
                            {{/each}}
                        </div>
                    </div>
                {{/each}}
            </div>
        </div>
    {{/if}}
{{/if}}

<style>
    .calendar-event-directeur {
        padding-bottom: 35px;
    }

    .calendar-event-actions {
        position: absolute;
        bottom: 5px;
        left: 8px;
        right: 8px;
        display: flex;
        gap: 5px;
        justify-content: center;
    }

    .btn-action {
        padding: 4px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-block;
    }

    .btn-edit {
        background: #ffc107;
        color: #000;
    }

    .btn-edit:hover {
        background: #ffb300;
        transform: scale(1.05);
    }

    .btn-delete {
        background: #dc3545;
        color: white;
    }

    .btn-delete:hover {
        background: #c82333;
        transform: scale(1.05);
    }
</style>
