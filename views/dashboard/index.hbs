<div class="dashboard">
    <div class="dashboard-header">
        <div class="header-content">
            <h1>ğŸ“Š Tableau de bord</h1>
            {{#if (eq user.role 'admin')}}
            <p class="dashboard-subtitle">Vue globale de tous les dÃ©partements</p>
            {{else if (eq user.role 'directeur')}}
            <p class="dashboard-subtitle">Gestion de votre dÃ©partement</p>
            {{else}}
            <p class="dashboard-subtitle">Bienvenue dans votre espace</p>
            {{/if}}
        </div>
        <div class="header-actions">
            <button id="theme-toggle" class="theme-toggle" title="Changer le thÃ¨me">
                <span class="theme-icon">ğŸŒ™</span>
            </button>
        </div>
    </div>

    {{#if (eq user.role 'admin')}}
    <!-- Dashboard ADMIN - Vue globale -->
    {{#if stats}}
    <!-- Statistiques principales -->
    <div class="stats-grid">
        <div class="stat-card stat-primary">
            <div class="stat-icon">ğŸ›ï¸</div>
            <div class="stat-content">
                <div class="stat-value">{{stats.departements}}</div>
                <div class="stat-label">DÃ©partements</div>
            </div>
            <div class="stat-badge">Actifs</div>
        </div>
        
        <div class="stat-card stat-success">
            <div class="stat-icon">ğŸ‘¨â€ğŸ«</div>
            <div class="stat-content">
                <div class="stat-value">{{stats.enseignants}}</div>
                <div class="stat-label">Enseignants</div>
            </div>
            <div class="stat-badge">Total</div>
        </div>
        
        <div class="stat-card stat-info">
            <div class="stat-icon">ğŸ‘¨â€ğŸ“</div>
            <div class="stat-content">
                <div class="stat-value">{{stats.etudiants}}</div>
                <div class="stat-label">Ã‰tudiants</div>
            </div>
            <div class="stat-badge">Inscrits</div>
        </div>
        
        <div class="stat-card stat-warning">
            <div class="stat-icon">ğŸ“š</div>
            <div class="stat-content">
                <div class="stat-value">{{stats.cours}}</div>
                <div class="stat-label">Cours</div>
            </div>
            <div class="stat-badge">PlanifiÃ©s</div>
        </div>
    </div>

    <!-- Graphiques -->
    <div class="charts-grid">
        <!-- RÃ©partition Ã©tudiants par dÃ©partement -->
        <div class="chart-card">
            <div class="chart-header">
                <h3>ğŸ“Š Ã‰tudiants par dÃ©partement</h3>
            </div>
            <canvas id="etudiantsChart"></canvas>
        </div>

        <!-- Cours par enseignant -->
        <div class="chart-card">
            <div class="chart-header">
                <h3>ğŸ“ˆ Cours par enseignant</h3>
            </div>
            <canvas id="coursChart"></canvas>
        </div>

        <!-- Ã‰volution inscriptions -->
        <div class="chart-card chart-full">
            <div class="chart-header">
                <h3>ğŸ“‰ Ã‰volution des inscriptions</h3>
            </div>
            <canvas id="inscriptionsChart"></canvas>
        </div>
    </div>
    {{/if}}
    {{/if}}

    {{#if (eq user.role 'directeur')}}
    <!-- Dashboard DIRECTEUR - Vue dÃ©partement -->
    {{#if stats}}
    <!-- Statistiques du dÃ©partement -->
    <div class="stats-grid">
        <div class="stat-card stat-success">
            <div class="stat-icon">ğŸ‘¨â€ğŸ«</div>
            <div class="stat-content">
                <div class="stat-value">{{stats.enseignants}}</div>
                <div class="stat-label">Enseignants</div>
            </div>
            <div class="stat-badge">DÃ©partement</div>
        </div>
        
        <div class="stat-card stat-info">
            <div class="stat-icon">ğŸ‘¨â€ğŸ“</div>
            <div class="stat-content">
                <div class="stat-value">{{stats.etudiants}}</div>
                <div class="stat-label">Ã‰tudiants</div>
            </div>
            <div class="stat-badge">Inscrits</div>
        </div>
        
        <div class="stat-card stat-warning">
            <div class="stat-icon">ğŸ“š</div>
            <div class="stat-content">
                <div class="stat-value">{{stats.cours}}</div>
                <div class="stat-label">Cours</div>
            </div>
            <div class="stat-badge">PlanifiÃ©s</div>
        </div>

        <div class="stat-card stat-danger">
            <div class="stat-icon">âš ï¸</div>
            <div class="stat-content">
                <div class="stat-value">{{stats.conflitsEnAttente}}</div>
                <div class="stat-label">Conflits</div>
            </div>
            <div class="stat-badge">Ã€ rÃ©soudre</div>
        </div>
    </div>

    <!-- Graphiques directeur -->
    <div class="charts-grid">
        <!-- RÃ©partition Ã©tudiants par groupe -->
        <div class="chart-card">
            <div class="chart-header">
                <h3>ğŸ“Š Ã‰tudiants par groupe</h3>
            </div>
            <canvas id="etudiantsChart"></canvas>
        </div>

        <!-- Cours par enseignant -->
        <div class="chart-card chart-full">
            <div class="chart-header">
                <h3>ğŸ“ˆ Charge de travail des enseignants</h3>
            </div>
            <canvas id="coursChart"></canvas>
        </div>
    </div>
    {{/if}}
    {{/if}}

    <!-- Cartes d'accÃ¨s rapide -->
    <div class="dashboard-cards">
        {{#if (eq user.role 'admin')}}
        <div class="card card-glass card-primary">
            <div class="card-icon-animated">ğŸ›ï¸</div>
            <h3>DÃ©partements</h3>
            <p>GÃ©rer les dÃ©partements de l'universitÃ©</p>
            <a href="/departements" class="btn btn-card">AccÃ©der</a>
        </div>
        
        <div class="card card-glass card-success">
            <div class="card-icon-animated">ğŸ‘¨â€ğŸ«</div>
            <h3>Enseignants</h3>
            <p>GÃ©rer la liste des enseignants</p>
            <a href="/enseignants" class="btn btn-card">AccÃ©der</a>
        </div>
        
        <div class="card card-glass card-info">
            <div class="card-icon-animated">ğŸ‘¨â€ğŸ“</div>
            <h3>Ã‰tudiants</h3>
            <p>GÃ©rer la liste des Ã©tudiants</p>
            <a href="/etudiants" class="btn btn-card">AccÃ©der</a>
        </div>
        
        <div class="card card-glass card-warning">
            <div class="card-icon-animated">ğŸ“š</div>
            <h3>Cours</h3>
            <p>Planifier et gÃ©rer les cours</p>
            <a href="/cours" class="btn btn-card">AccÃ©der</a>
        </div>

        <div class="card card-glass card-primary">
            <div class="card-icon-animated">ğŸ“…</div>
            <h3>Emplois du temps</h3>
            <p>Voir les emplois par dÃ©partement</p>
            <a href="/emplois/mon" class="btn btn-card">AccÃ©der</a>
        </div>

        <div class="card card-glass card-danger">
            <div class="card-icon-animated">âŒ</div>
            <h3>Absences</h3>
            <p>GÃ©rer toutes les absences</p>
            <a href="/absences" class="btn btn-card">AccÃ©der</a>
        </div>

        <div class="card card-glass card-info">
            <div class="card-icon-animated">ğŸ“Š</div>
            <h3>Notes</h3>
            <p>Consulter toutes les notes</p>
            <a href="/notes" class="btn btn-card">AccÃ©der</a>
        </div>
        {{/if}}

        {{#if (eq user.role 'directeur')}}
        <div class="card card-glass card-primary">
            <div class="card-icon-animated">ğŸ“…</div>
            <h3>Emploi du temps</h3>
            <p>Voir l'emploi du temps du dÃ©partement</p>
            <a href="/emplois/mon" class="btn btn-card">Voir</a>
        </div>

        <div class="card card-glass card-warning">
            <div class="card-icon-animated">ğŸ“š</div>
            <h3>GÃ©rer les cours</h3>
            <p>CrÃ©er et modifier les cours</p>
            <a href="/cours" class="btn btn-card">GÃ©rer</a>
        </div>

        <div class="card card-glass card-danger">
            <div class="card-icon-animated">âš ï¸</div>
            <h3>Conflits</h3>
            <p>RÃ©soudre les conflits d'emploi du temps</p>
            <a href="/cours" class="btn btn-card">Voir conflits</a>
        </div>
        
        <div class="card card-glass card-success">
            <div class="card-icon-animated">ğŸ‘¨â€ğŸ«</div>
            <h3>Enseignants</h3>
            <p>GÃ©rer les enseignants du dÃ©partement</p>
            <a href="/enseignants" class="btn btn-card">AccÃ©der</a>
        </div>
        
        <div class="card card-glass card-info">
            <div class="card-icon-animated">ğŸ‘¨â€ğŸ“</div>
            <h3>Ã‰tudiants</h3>
            <p>Suivi des Ã©tudiants et absences</p>
            <a href="/etudiants" class="btn btn-card">AccÃ©der</a>
        </div>

        <div class="card card-glass card-warning">
            <div class="card-icon-animated">ğŸ“š</div>
            <h3>MatiÃ¨res & Groupes</h3>
            <p>Administrer les matiÃ¨res et groupes</p>
            <a href="/cours" class="btn btn-card">GÃ©rer</a>
        </div>

        <div class="card card-glass card-secondary">
            <div class="card-icon-animated">ğŸ¢</div>
            <h3>Salles</h3>
            <p>Occupation et disponibilitÃ© des salles</p>
            <a href="/cours" class="btn btn-card">Voir disponibilitÃ©s</a>
        </div>

        <div class="card card-glass card-danger">
            <div class="card-icon-animated">âŒ</div>
            <h3>Absences du dÃ©partement</h3>
            <p>Consulter et valider les absences</p>
            <a href="/absences" class="btn btn-card">AccÃ©der</a>
        </div>

        <div class="card card-glass card-info">
            <div class="card-icon-animated">ğŸ’¯</div>
            <h3>Notes du dÃ©partement</h3>
            <p>Statistiques et consultation</p>
            <a href="/notes" class="btn btn-card">AccÃ©der</a>
        </div>
        {{/if}}

        {{#if (eq user.role 'enseignant')}}
        <div class="card card-glass card-primary">
            <div class="card-icon-animated">ğŸ“…</div>
            <h3>Mon emploi du temps</h3>
            <p>Consulter mon planning</p>
            <a href="/emplois/mon" class="btn btn-card">AccÃ©der</a>
        </div>
        
        <div class="card card-glass card-success">
            <div class="card-icon-animated">ğŸ“</div>
            <h3>Mes cours</h3>
            <p>GÃ©rer mes cours</p>
            <a href="/cours" class="btn btn-card">AccÃ©der</a>
        </div>

        <div class="card card-glass card-danger">
            <div class="card-icon-animated">âŒ</div>
            <h3>Absences</h3>
            <p>Marquer les absences de mes cours</p>
            <a href="/absences" class="btn btn-card">AccÃ©der</a>
        </div>

        <div class="card card-glass card-warning">
            <div class="card-icon-animated">ğŸ’¯</div>
            <h3>Notes</h3>
            <p>Saisir et gÃ©rer les notes</p>
            <a href="/notes" class="btn btn-card">AccÃ©der</a>
        </div>
        {{/if}}

        {{#if (eq user.role 'etudiant')}}
        <div class="card card-glass card-primary">
            <div class="card-icon-animated">ğŸ“…</div>
            <h3>Mon emploi du temps</h3>
            <p>Consulter mon planning hebdomadaire</p>
            <a href="/emplois/mon" class="btn btn-card">AccÃ©der</a>
        </div>
        
        <div class="card card-glass card-success">
            <div class="card-icon-animated">ğŸ“š</div>
            <h3>Mes cours</h3>
            <p>Voir tous mes cours du groupe</p>
            <a href="/cours" class="btn btn-card">AccÃ©der</a>
        </div>
        
        <div class="card card-glass card-info">
            <div class="card-icon-animated">ğŸ¯</div>
            <h3>Mes notes</h3>
            <p>Consulter mes rÃ©sultats et moyennes</p>
            <a href="/notes" class="btn btn-card">AccÃ©der</a>
        </div>
        
        <div class="card card-glass card-warning">
            <div class="card-icon-animated">âŒ</div>
            <h3>Mes absences</h3>
            <p>Consulter et justifier mes absences</p>
            <a href="/absences" class="btn btn-card">AccÃ©der</a>
        </div>
        {{/if}}
    </div>
</div>

{{#if (isIn user.role 'admin' 'directeur')}}
{{#if stats}}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
// DonnÃ©es des graphiques
const etudiantsData = {{{json stats.etudiantsParDept}}};
const coursData = {{{json stats.coursParEnseignant}}};
const inscriptionsData = {{{json stats.inscriptionsParMois}}};

// Configuration commune
const commonOptions = {
    responsive: true,
    maintainAspectRatio: true,
    plugins: {
        legend: {
            position: 'bottom',
            labels: {
                padding: 15,
                font: { size: 12 }
            }
        }
    }
};

// Graphique: Ã‰tudiants par dÃ©partement
if (etudiantsData && etudiantsData.length > 0) {
    new Chart(document.getElementById('etudiantsChart'), {
        type: 'doughnut',
        data: {
            labels: etudiantsData.map(d => d.departement),
            datasets: [{
                data: etudiantsData.map(d => d.total),
                backgroundColor: ['#1e3a8a', '#0891b2', '#059669', '#f59e0b', '#dc2626', '#7c3aed'],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: commonOptions
    });
}

// Graphique: Cours par enseignant
if (coursData && coursData.length > 0) {
    new Chart(document.getElementById('coursChart'), {
        type: 'bar',
        data: {
            labels: coursData.map(d => d.enseignant),
            datasets: [{
                label: 'Nombre de cours',
                data: coursData.map(d => d.total),
                backgroundColor: '#1e3a8a',
                borderRadius: 8
            }]
        },
        options: {
            ...commonOptions,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { stepSize: 1 }
                }
            }
        }
    });
}

// Graphique: Ã‰volution inscriptions
if (inscriptionsData && inscriptionsData.length > 0) {
    new Chart(document.getElementById('inscriptionsChart'), {
        type: 'line',
        data: {
            labels: inscriptionsData.map(d => d.mois),
            datasets: [{
                label: 'Inscriptions',
                data: inscriptionsData.map(d => d.total),
                borderColor: '#0891b2',
                backgroundColor: 'rgba(8, 145, 178, 0.1)',
                fill: true,
                tension: 0.4,
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        },
        options: {
            ...commonOptions,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { stepSize: 1 }
                }
            }
        }
    });
}
</script>
{{/if}}
{{/if}}